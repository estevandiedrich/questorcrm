<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
   xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
   xmlns:f="http://xmlns.jcp.org/jsf/core"
   xmlns:h="http://xmlns.jcp.org/jsf/html"
   xmlns:p="http://primefaces.org/ui"
   template="/WEB-INF/templates/default.xhtml">
   <ui:define name="content">
   	<script type="text/javascript">
   		function  modalGrupoUsuarios()
   		{
   			$('#myModal').modal('show');
   		}
   		function modalLeadPai()
   		{
   			$('#myModal2').modal('show');
   		}
   		function selecionarGrupoUsuarios()
   		{
   			var table = $('#grupoUsuariosDataTable').DataTable();
			var id = table.row('.selected').data()[0];
			$('#regLeads\\:grupoUsuarios').val(id);
			$('#myModal').modal('hide');
   		}
   		function selecionarLeadPai()
   		{
   			var table = $('#leadsPaiDataTable').DataTable();
			var id = table.row('.selected').data()[0];
			$('#regLeads\\:membro').val(id);
			$('#myModal2').modal('hide');
   		}
   		$(document).ready(
			function() {
			var table = $('#leadsDataTable').DataTable();
			var table2 = $('#regLeads\\:grupoUsuariosLeadDataTable').DataTable();
			var table3 = $('#grupoUsuariosDataTable').DataTable();
			$('#leadsDataTable tbody').on('click','tr',
			function() {
				if ($(this).hasClass('selected')) {
					$(this).removeClass('selected');
				} else {
					table.$('tr.selected').removeClass(
							'selected');
					$(this).addClass('selected');
				}
			});
			$('#regLeads\\:grupoUsuariosLeadDataTable tbody').on('click','tr',
			function() {
				if ($(this).hasClass('selected')) {
					$(this).removeClass('selected');
				} else {
					table2.$('tr.selected').removeClass(
							'selected');
					$(this).addClass('selected');
				}
			});
			$('#grupoUsuariosDataTable tbody').on('click','tr',
			function() {
				if ($(this).hasClass('selected')) {
					$(this).removeClass('selected');
				} else {
					table3.$('tr.selected').removeClass(
							'selected');
					$(this).addClass('selected');
				}
			});
		});
		$(window).load(function() {
		    jsf.ajax.addOnEvent(function (data) {
		        if (data.status == "success") {debugger
		        	var table = $('#regLeads\\:grupoUsuariosLeadDataTable').DataTable();
		 		    $('#regLeads\\:grupoUsuariosLeadDataTable tbody').on( 'click', 'tr', function () {
		 		        if ( $(this).hasClass('selected') ) {
		 		            $(this).removeClass('selected');
		 		        }
		 		        else {
		 		            table.$('tr.selected').removeClass('selected');
		 		            $(this).addClass('selected');
		 		        }
		 		    } );
		        }
		    })
		});
   	</script>
      <h1>Cadastro de Leads</h1>

      <h:form id="regLeads" enctype="multipart/form-data">
		<h:panelGrid>
         <h:outputLabel for="nome" value="Nome:" />
         <h:inputText id="nome" value="#{newLead.nome}" />
         <h:message for="nome" errorClass="invalid" />
         <h:outputLabel for="foto" value="Foto:" />
		 <h:inputFile id="foto" value="#{newLead.imagemPart}">
<!-- 			<f:validator binding="#{fileUploadValidator}"/> -->
		 </h:inputFile>
		 <h:outputLabel for="membro" value="Membro:"/>
		 <h:panelGroup>
		 	<h:inputText id="membro" value="#{newLead.leadPai.id}"/>
		 	<h:graphicImage library="images" name="magnifying.png" onclick="javascript:modalLeadPai()"/>
		 </h:panelGroup>
         <h:outputLabel for="grupoUsuarios" value="Grupos de Usuários:"/>
		 <h:panelGroup>
		 	<h:inputText id="grupoUsuarios" value="#{newLead.grupoUsuariosSelecionado.id}"/>
		 	<h:graphicImage library="images" name="magnifying.png" onclick="javascript:modalGrupoUsuarios()"/>
		 </h:panelGroup>
		 <br/>
		 <h:commandButton id="adicionarGrupoUsuarios" action="#{salvarLead.adicionarGrupoUsuarios(newLead.grupoUsuariosSelecionado.id)}" value="Adicionar">
			<f:ajax execute="regLeads:grupoUsuarios" render="regLeads:gruposUsuariosPanelGrid"/>
		</h:commandButton>
		<br/>
		<h:panelGrid id="gruposUsuariosPanelGrid">
	      <h:panelGroup rendered="#{empty newLead.gruposUsuarios}">
	         <em>Nenhum Grupo registrado.</em>
	      </h:panelGroup>
	      <h:dataTable id="grupoUsuariosLeadDataTable" var="_grupoUsuarios" value="#{newLead.gruposUsuarios}"
			rendered="#{not empty newLead.gruposUsuarios}"
			styleClass="table"
			width="100%"
			style="display:inline-table"
			 headerClass="table-header"
			 rowClasses="table-odd-row,table-even-row">
	         <h:column>
	            <f:facet name="header">Id</f:facet>
	                #{_grupoUsuarios.id}
	            </h:column>
	         <h:column>
	            <f:facet name="header">Descrição</f:facet>
	                #{_grupoUsuarios.descricao}
	            </h:column>                
	      </h:dataTable>
	      </h:panelGrid>
	      
	     <p:calendar value="#{newLead.dataSelecionada}" mode="inline" />
	     
	     <ui:include src="/pages/protected/user/contato.xhtml">
			<ui:param name="lead" value="#{newLead}" />
		 </ui:include>
		 
		 <ui:include src="/pages/protected/user/anexo.xhtml">
			<ui:param name="lead" value="#{newLead}" />
		 </ui:include>  
	     
         <p>
            <h:commandButton id="salvar"
               action="#{salvarLead.salvar}" value="Salvar" />

         </p>
        </h:panelGrid>
      </h:form>
      <h2>Leads</h2>
      <h:panelGroup rendered="#{empty leads}">
         <em>Nenhum lead registrado.</em>
      </h:panelGroup>
      <h:dataTable id="leadsDataTable" var="_lead" value="#{leads}"
		rendered="#{not empty leads}"
		styleClass="table"
		 headerClass="table-header"
		 rowClasses="table-odd-row,table-even-row">
         <h:column>
            <f:facet name="header">Id</f:facet>
                #{_lead.id}
            </h:column>
         <h:column>
            <f:facet name="header">Nome</f:facet>
                #{_lead.nome}
            </h:column>
      </h:dataTable>
      <!-- Modal -->
		<div id="myModal" class="modal fade" role="dialog">
			<div class="modal-dialog">
				<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">X</button>
						<h4 class="modal-title">Selecione o Grupo de usuários</h4>
					</div>
					<div class="modal-body">
						<h2>Grupos de usuários</h2>
					      <h:panelGroup rendered="#{empty gruposUsuarios}">
					         <em>Nenhum Grupo registrado.</em>
					      </h:panelGroup>
					      <h:dataTable id="grupoUsuariosDataTable" var="_grupoUsuarios" value="#{gruposUsuarios}"
							rendered="#{not empty gruposUsuarios}"
							styleClass="table"
							 headerClass="table-header"
							 rowClasses="table-odd-row,table-even-row">
					         <h:column>
					            <f:facet name="header">Id</f:facet>
					                #{_grupoUsuarios.id}
					            </h:column>
					         <h:column>
					            <f:facet name="header">Descrição</f:facet>
					                #{_grupoUsuarios.descricao}
					            </h:column>                
					      </h:dataTable>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary"
							onclick="javascript:selecionarGrupoUsuarios()">Selecionar</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
					</div>
				</div>
			</div>
		</div>
		<!-- Modal -->
		<div id="myModal2" class="modal fade" role="dialog">
			<div class="modal-dialog">
				<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">X</button>
						<h4 class="modal-title">Selecione o Lead pai</h4>
					</div>
					<div class="modal-body">
						<h:panelGroup rendered="#{empty leads}">
					         <em>Nenhum lead registrado.</em>
					      </h:panelGroup>
					      <h:dataTable id="leadsPaiDataTable" var="_lead" value="#{leads}"
							rendered="#{not empty leads}"
							styleClass="table"
							 headerClass="table-header"
							 rowClasses="table-odd-row,table-even-row">
					         <h:column>
					            <f:facet name="header">Id</f:facet>
					                #{_lead.id}
					            </h:column>
					         <h:column>
					            <f:facet name="header">Nome</f:facet>
					                #{_lead.nome}
					            </h:column>
					      </h:dataTable>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary"
							onclick="javascript:selecionarLeadPai()">Selecionar</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
					</div>
				</div>
			</div>
		</div>
   </ui:define>
</ui:composition>
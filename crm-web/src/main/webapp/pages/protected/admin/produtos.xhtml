<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	template="/WEB-INF/templates/default.xhtml">
	<ui:define name="content">
		<script type="text/javascript">
			function modalModulo() {
				$('#myModal').modal('show');
			}
			function modalModulosDoProduto()
			{
				$('#myModal2').modal('show');
			}
			function selecionarModulo() {
				debugger
				var table = $('#modulosDataTable').DataTable();
				var id = table.row('.selected').data()[0];
				$('#regProdutos\\:modulo').val(id);
				$('#myModal').modal('hide');
			}
			$(document).ready(
				function() {
					var table = $('#produtosDataTable').DataTable();
					var table2 = $('#modulosDataTable').DataTable();
					var table3 = $('#regProdutos\\:modulosProduto').DataTable();
					var table4 = $('#modulosDoProdutoDataTable').DataTable();

					$('#produtosDataTable tbody').on(
							'click',
							'tr',
							function() {
								if ($(this).hasClass('selected')) {
									$(this).removeClass('selected');
								} else {
									table.$('tr.selected').removeClass(
											'selected');
									$(this).addClass('selected');
								}
							});
					$('#modulosDataTable tbody').on(
							'click',
							'tr',
							function() {
								if ($(this).hasClass('selected')) {
									$(this).removeClass('selected');
								} else {
									table2.$('tr.selected').removeClass(
											'selected');
									$(this).addClass('selected');
								}
							});
					$('#regProdutos\\:modulosProduto tbody').on(
							'click',
							'tr',
							function() {
								if ($(this).hasClass('selected')) {
									$(this).removeClass('selected');
								} else {
									table3.$('tr.selected').removeClass(
											'selected');
									$(this).addClass('selected');
								}
							});
					$('#modulosDoProdutoDataTable tbody').on(
							'click',
							'tr',
							function() {
								if ($(this).hasClass('selected')) {
									$(this).removeClass('selected');
								} else {
									table4.$('tr.selected').removeClass(
											'selected');
									$(this).addClass('selected');
								}
							});
				});
			$(window).load(function() {
			    jsf.ajax.addOnEvent(function (data) {
			        if (data.status == "success") {debugger
			        	var table = $('#regProdutos\\:modulosProduto').DataTable();
			        	var table2 = $('#modulosDoProdutoDataTable').DataTable();
			 		    $('#regProdutos\\:modulosProduto tbody').on( 'click', 'tr', function () {
			 		        if ( $(this).hasClass('selected') ) {
			 		            $(this).removeClass('selected');
			 		        }
			 		        else {
			 		            table.$('tr.selected').removeClass('selected');
			 		            $(this).addClass('selected');
			 		        }
			 		    } );
			 		    
			 		   $('#modulosDoProdutoDataTable tbody').on('click','tr',function() {
							if ($(this).hasClass('selected')) {
								$(this).removeClass('selected');
							} else {
								table2.$('tr.selected').removeClass(
										'selected');
								$(this).addClass('selected');
							}
						});
			        }
			    })
			});
		</script>
		<h1>Cadastro de Produtos</h1>

		<h:form id="regProdutos">
			<h:panelGrid>
				<h:outputLabel for="descricao" value="Descrição:" />
				<h:inputText id="descricao" value="#{newProduto.descricao}" />
				<h:message for="descricao" errorClass="invalid" />
				<h:outputLabel for="modulo" value="Módulo:" />
				<h:panelGroup>
					<h:inputText id="modulo" value="#{newProduto.modulo.id}" />
					<h:graphicImage library="images" name="magnifying.png" onclick="javascript:modalModulo()"/> 
				</h:panelGroup>
				<h:message for="modulo" errorClass="invalid" />
				<br/>
				<h:commandButton id="adicionar" action="#{salvarProduto.adicionar(newProduto.modulo.id)}" value="Adicionar">
					<f:ajax execute="regProdutos:modulo" render="regProdutos:modulosDoProdutoPanelGrid"/>
				</h:commandButton>
				<br/>
				<h:panelGrid id="modulosDoProdutoPanelGrid">
					<h:panelGroup rendered="#{empty newProduto.modulos}">
			         	<em>Nenhum módulo adicionado.</em>
			      	 </h:panelGroup>
			         <h:dataTable id="modulosProduto" var="_modulo" value="#{newProduto.modulos}"
			         	rendered="#{not empty newProduto.modulos}"
			         	width="100%"
			         	style="display:inline-table;"
			         	styleClass="table"
					 	headerClass="table-header"
					 	rowClasses="table-odd-row,table-even-row">
			         	<h:column>
			            	<f:facet name="header">Id</f:facet>
			                	#{_modulo.id}
			            </h:column>
			         	<h:column>
			            	<f:facet name="header">Descrição</f:facet>
			                	#{_modulo.descricao}
			            </h:column>
			     	 </h:dataTable>
		     	 </h:panelGrid>
				<br />
				<h:commandButton id="salvar" action="#{salvarProduto.salvar()}"
					value="Salvar" />
				<h:outputText value=" Salvo!"
					rendered="#{facesContext.postback and empty facesContext.messageList}"
					style="color: green;" />
			</h:panelGrid>
		</h:form>
		<h2>Produtos</h2>
		<h:panelGroup rendered="#{empty produtos}">
			<em>Nenhum produto registrado.</em>
		</h:panelGroup>
		<h:dataTable id="produtosDataTable" var="_produto" value="#{produtos}"
			rendered="#{not empty produtos}" styleClass="table"
			headerClass="table-header" rowClasses="table-odd-row,table-even-row">
			<h:column>
				<f:facet name="header">Id</f:facet>
                #{_produto.id}
            </h:column>
			<h:column>
				<f:facet name="header">Descrição</f:facet>
                #{_produto.descricao}
            </h:column>
            <h:column>
            	<f:facet name="header"></f:facet>
        			<h:form>
		                <h:commandLink value="Modulos" action="#{salvarProduto.setNewProduto(_produto)}" onclick="javascript:modalModulosDoProduto()">
		                	<f:ajax render="modulosDoProdutoPanelGrid"/>
		                </h:commandLink>
	                </h:form>	                
            </h:column>
            <h:column>
            	<h:form>
	                <h:commandLink value="Editar" action="#{salvarProduto.setNewProduto(_produto)}">
	                </h:commandLink>
                </h:form>
            </h:column>
		</h:dataTable>
		<!-- Modal -->
		<div id="myModal" class="modal fade" role="dialog">
			<div class="modal-dialog">
				<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">X</button>
						<h4 class="modal-title">Selecione o modulo</h4>
					</div>
					<div class="modal-body">
						<h:panelGroup rendered="#{empty modulos}">
							<em>Nenhum modulo registrado.</em>
						</h:panelGroup>
						<h:dataTable id="modulosDataTable" var="_modulo"
							value="#{modulos}" rendered="#{not empty modulos}"
							styleClass="table" headerClass="table-header"
							rowClasses="table-odd-row,table-even-row">
							<h:column>
								<f:facet name="header">Id</f:facet>
                				#{_modulo.id}
            				</h:column>
							<h:column>
								<f:facet name="header">Descrição</f:facet>
               					#{_modulo.descricao}
           					</h:column>
						</h:dataTable>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary"
							onclick="javascript:selecionarModulo()">Selecionar</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
					</div>
				</div>
			</div>
		</div>
		<!-- Modal -->
		<div id="myModal2" class="modal fade" role="dialog">
			<div class="modal-dialog">
				<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">X</button>
						<h4 class="modal-title">Selecione o modulo</h4>
					</div>
					<div class="modal-body">
					<h:panelGrid id="modulosDoProdutoPanelGrid">
						<h:panelGroup rendered="#{empty newProduto.modulos}">
							<em>Nenhum modulo registrado.</em>
						</h:panelGroup>						
						<h:dataTable id="modulosDoProdutoDataTable" var="_modulo"
							value="#{newProduto.modulos}" rendered="#{not empty newProduto.modulos}"
							style="display:inline-table"
							width="100%"
							styleClass="table" headerClass="table-header"
							rowClasses="table-odd-row,table-even-row">
							<h:column>
								<f:facet name="header">Id</f:facet>
                				#{_modulo.id}
            				</h:column>
							<h:column>
								<f:facet name="header">Descrição</f:facet>
               					#{_modulo.descricao}
           					</h:column>
						</h:dataTable>
					</h:panelGrid>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
					</div>
				</div>
			</div>
		</div>
	</ui:define>
</ui:composition>

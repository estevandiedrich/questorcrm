<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
   xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
   xmlns:f="http://xmlns.jcp.org/jsf/core"
   xmlns:h="http://xmlns.jcp.org/jsf/html"
   template="/WEB-INF/templates/default2.xhtml">
   <ui:define name="content2">
   <script type="text/javascript">
   $(document).ready(function() {
	    var table = $('#cotacoesDataTable').DataTable();
	 
	    $('#cotacoesDataTable tbody').on( 'click', 'tr', function () {
	        if ( $(this).hasClass('selected') ) {
	            $(this).removeClass('selected');
	        }
	        else {
	            table.$('tr.selected').removeClass('selected');
	            $(this).addClass('selected');
	        }
	    } );
	 
// 	    $('#button').click( function () {
// 	        table.row('.selected').remove().draw( false );
// 	    } );
	} );
   $(window).load(function() {
	    jsf.ajax.addOnEvent(function (data) {
	        if (data.status == "success") {debugger
	        	 var table = $('#cotacoesDataTable').DataTable();
	 		    $('#cotacoesDataTable tbody').on( 'click', 'tr', function () {
	 		        if ( $(this).hasClass('selected') ) {
	 		            $(this).removeClass('selected');
	 		        }
	 		        else {
	 		            table.$('tr.selected').removeClass('selected');
	 		            $(this).addClass('selected');
	 		        }
	 		    } );
	        }
	    })
	});
   </script>
   
      <h1>Nova negociação</h1>

      <h:form id="regCotacao">
		<h:panelGrid>
			<h:outputLabel for="texto" value="Texto:" />
            <h:inputTextarea id="texto" value="#{newCotacao.texto}" />
            <h:message for="texto" errorClass="invalid" />
            <h:outputLabel for="valor" value="Valor:" />
            <h:inputText id="valor" value="#{newCotacao.valor}" />
            <h:message for="valor" errorClass="invalid" />
         <p>
            <h:commandButton id="adicionar"
               action="#{salvarCotacao.adicionar()}" value="Adicionar">
               <f:ajax execute="regCotacao:texto regCotacao:valor" render="tablePanelCotacoes"/>
            </h:commandButton>
            <h:outputText value=" Salvo!"
               rendered="#{facesContext.postback and empty facesContext.messageList}"
               style="color: green;" />
         </p>
         </h:panelGrid>
      </h:form>
      <h2>Negociações</h2>
      <h:panelGrid id="tablePanelCotacoes">
	      <h:panelGroup rendered="#{empty cotacoes}">
	         <em>Nenhuma negociação registrada.</em>
	      </h:panelGroup>
	      <h:dataTable id="cotacoesDataTable" var="_cotacao" value="#{cotacoes}"
			rendered="#{not empty cotacoes}"
			width="100%"
        	style="display:inline-table;"
			styleClass="table"
			 headerClass="table-header"
			 rowClasses="table-odd-row,table-even-row">
	         <h:column>
	            <f:facet name="header">Id</f:facet>
	                <h:outputText value="#{_cotacao.id}"/>
	            </h:column>
	         <h:column>
	            <f:facet name="header">Texto</f:facet>
	                <h:outputText value="#{_cotacao.texto}"/>
	            </h:column>
	         <h:column>
	            <f:facet name="header">Valor</f:facet>
	                <h:outputText value="#{_cotacao.valor}"/>
	            </h:column>                
	      </h:dataTable>
      </h:panelGrid>
   </ui:define>
</ui:composition>